Configuration Strings
~~~~~~~~~~~~~~~~~~~~~~~

Base URL
*********

+------------------+------------------------------+
| Command ID       | b                            |
+------------------+------------------------------+
| Parameter Length | up to 64                     |
+------------------+------------------------------+
| Parameter value  | Any URL-safe string          |
+------------------+------------------------------+

Example 1: ``<b:localhost:5000>``

Example 2: ``<b:latest.f.cupl.uk>``

This URL will be opened by a phone that taps cuplTag. It should point to a `web application`_ that decodes the `cupl URL parameters`_. 

The scheme (e.g. HTTPS) must not be included.

The domain (e.g. latest.f.cupl.uk) is required. 

The port (e.g. 5000) is only required if it differs from 443 for HTTPS or 80 for HTTP.  

.. _web application: https://github.com/cuplsensor/cuplfrontend

.. _cupl URL parameters: https://cupl.readthedocs.io/projects/codec/en/latest/docs/specification/features.html#url-parameters


Serial
********

+------------------+---------------------+
| Command ID       | w                   |
+------------------+---------------------+
| Parameter Length | 8                   |
+------------------+---------------------+
| Parameter value  | Any URL-safe Base64 |
+------------------+---------------------+

Example: ``<w:KEG2lARW>``

Each cuplTag in a deployment must be uniquely identified by an 8 character serial string. This is written into a `dedicated URL parameter`_ on startup. 

The serial string is normally generated by the web application, when a new tag is defined. It can later be used to view data captured 
from a tag (e.g. https://latest.f.cupl.uk/tag/KEG2lARW).

.. _dedicated URL parameter: https://cupl.readthedocs.io/projects/codec/en/latest/docs/specification/features.html#CODEC_FEAT_38


HMAC Secret Key
*****************

+------------------+---------------------+
| Command ID       | s                   |
+------------------+---------------------+
| Parameter Length | 16                  |
+------------------+---------------------+
| Parameter value  | Any URL-safe Base64 |
+------------------+---------------------+

Example: ``<s:4EOBdBWTsjeFZTm3>``

The secret key is used to generate a `Hash-based Message Authentication Code`_, which is updated whenever a new sample is added to the URL. 

It must be randomly generated and unique to each cuplTag in a deployment. It is feasible for one tag (and the key therein) to be comprimised. 

The secret key will normally be generated by the web application, when a new tag is defined. It is shared between the application and the tag only. 

No data read from a tag will be stored by the web application without HMAC verification; the HMAC computed from the secret key must match that read from cuplTag.

.. _Hash-based Message Authentication Code: https://cupl.readthedocs.io/projects/codec/en/latest/docs/specification/features.html#CODEC_FEAT_24


Sample Interval in Minutes
****************************

+------------------+---------------------+
| Command ID       | t                   |
+------------------+---------------------+
| Parameter Length | 5 (max)             |
+------------------+---------------------+
| Parameter value  | Integer (16-bit)    |
+------------------+---------------------+

Example: ``<t:20>`` for a 20 minute interval.

This sets the time interval between samples in minutes. The minimum interval supported by the web application is 3 minutes. The maximum is 65535 minutes (6 weeks).

The time interval is base64 encoded and written into a `URL parameter` on startup. The web application uses this to timestamp all samples stored on the tag.

.. _URL parameter: https://cupl.readthedocs.io/projects/codec/en/latest/docs/specification/features.html#CODEC_FEAT_10


Disable HTTPS
**************

+------------------+---------------------------------------+
| Command ID       | h                                     |
+------------------+---------------------------------------+
| Parameter Length | 1                                     |
+------------------+---------------------------------------+
| Parameter value  | 0 (HTTPS), 1 (HTTP)                   |
+------------------+---------------------------------------+

Example: ``<h:1>`` to use HTTP (insecure) instead of HTTPS.

Disables HTTPS in the web application URL. This can be helpful during development, because there is no need to obtain an SSL certificate. Not encouraged for production. 

HTTPS and HTTP are the only 2 schemes supported by cuplTag for now.


Use HMAC
************

+------------------+---------------------------------------+
| Command ID       | i                                     |
+------------------+---------------------------------------+
| Parameter Length | 1                                     |
+------------------+---------------------------------------+
| Parameter value  | 0 (HMAC disabled), 1 (HMAC enabled)   |
+------------------+---------------------------------------+

Example ``<i:1>`` to use HMAC-MD5.

When HMAC is disabled, an MD5 checksum is calculated in its place. This means that the secret key is ignored and a decode will be successful providing that the checksums match. 

The feature was used during development, but it is not advised for production. MD5 may suffice for stateless web applications that do not store data from the tag. Standalone MD5 is deprecated as a checksum algorithm.


Minimum Battery Voltage (mV)
*****************************

+------------------+---------------------+
| Command ID       | u                   |
+------------------+---------------------+
| Parameter Length | 4                   |
+------------------+---------------------+
| Parameter value  | Integer (16-bit)    |
+------------------+---------------------+

Example: ``<u:2200>``

Sets the voltage below which the cuplTag does not operate.


Sample Format
**************

+------------------+----------------------------------------------+
| Command ID       | f                                            |
+------------------+----------------------------------------------+
| Parameter Length | 1                                            |
+------------------+----------------------------------------------+
| Parameter value  | 1 (Temperature + RH), 2 (Temperature only)   |
+------------------+----------------------------------------------+

Example 1: ``<f:1>`` for each sample to contain a temperature and relative humidity reading.

Example 2: ``<f:2>`` for each sample to contain a temperature reading only. This doubles the sample capacity.
